---
title: "Patton & Guimond Final Project: EVAULATING TEMPERATURE TRENDS AT US ARMY BASIC TRAINING INSTALLATIONS"
author: "Erik Patton & Austin Guimond"
date: "Fall 2022"
output:
  pdf_document: default
  html_document: default
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory

# Load your packages
#install.packages('TinyText')
#install.packages('LaTex')
#library(LaTex)
#install.packages('agricolae')
#install.packages('corrplot')
#install.packages('sf')
#install.packages('mapview')
#install.packages("viridis")
library(tidyverse)
library(lubridate)
library(zoo)
library(ggplot2)
library(trend)
library(Kendall)
library(tseries)
library(dplyr)
library(formatR)
library(agricolae)
library(corrplot)
library(mapview)
library(sf)
library(leaflet)
library(viridis)
library(cowplot)

# Set your ggplot theme


# Load temperature data sets
Jackson_Raw <- read.csv("~/Library/Mobile Documents/com~apple~CloudDocs/R Files/Patton_Guimond_ENV872_Final_Project/Data/Raw Data/Jackson_TenYear.csv",
                         stringsAsFactors = TRUE)
KFSI_Clean <- read.csv("~/Library/Mobile Documents/com~apple~CloudDocs/R Files/Patton_Guimond_ENV872_Final_Project/Data/Processed Data/KFSI_Clean.csv",
                         stringsAsFactors = TRUE)
KLSF_Clean <- read.csv("~/Library/Mobile Documents/com~apple~CloudDocs/R Files/Patton_Guimond_ENV872_Final_Project/Data/Processed Data/KLSF_Clean.csv",
                         stringsAsFactors = TRUE) 
KTBN_Clean <- read.csv("~/Library/Mobile Documents/com~apple~CloudDocs/R Files/Patton_Guimond_ENV872_Final_Project/Data/Processed Data/KTBN_Clean.csv",
                         stringsAsFactors = TRUE) 

#Load data sets for mapping visualization
All_Installations_sf <- st_read('/Users/erikpatton/Library/Mobile Documents/com~apple~CloudDocs/Duke/Data_Dissertation/Map Data/tl_2019_us_mil/tl_2019_us_mil.shp')%>%
  select('FULLNAME','geometry')%>%
  filter(FULLNAME=="Ft Jackson"|FULLNAME=="Ft Benning"|FULLNAME=="Ft Sill"|FULLNAME=="Ft Leonard Wood")
All_Counties <- st_read('/Users/erikpatton/Library/Mobile Documents/com~apple~CloudDocs/R Files/Patton_Guimond_ENV872_Final_Project/Data/Raw Data/cb_2018_us_county_20m')

```


# Rationale and Research Questions

## Rationale
This project advances research done as part of a dissertation by analyzing temperature trends against thresholds set to protect against heat illness during physical activity. Although it focuses on temperature on military installations and uses temperature thresholds derived by the military, there is broad applicability to any group that performs physically demanding outdoor work. 

##Research Questions
###Research Question #1: Has there been a change to temperature trends at the four army basic training installations in the decade between 2012-2022? 

-1a: Are trends the same or different for Heat Index and Wet Bulb Globe Temperature? 

-1b: Are there trends in the number of “Black Flag” and “Red Flag” days at the installations? 

###Research Question #2: How many days was the temperature in each of the “Color Flag” temperature categories for each installation? 

\newpage

# Dataset Information

Four datasets were obtained from the US Air Force 14th Weather Squadron, which collects “authoritative climate data” for the military. Each dataset contains observations from a weather gauge on or near one of four army basic training installations (Table 1).  

 |      | Fort Jackson, SC    |Fort Benning, GA   |Fort Sill, OK    |Fort Leonard Wood, MO|
 |:---    |   :---:   |   :---:   |     :---:           |   :---:       |   :---:           |
 |Installation Abbreviation   |FJSC|FBGA|FSOK|FLW|
 |Weather Station ID|KCUB|KLSF|KFSI|KTBN|
 |OBSERVATIONS|93,099|93,016|91,404|92,202|

Hourly data for the period of 2012-01-01 00:00:00 to 2022-09-30 23:00 was provided for each basic training installation. Data included the following observations: Temperature (F), Dewpoint (F), Relative Humidity, Heat Index (F), Derived Wet Bulb Glode Temperature (F). Each of the files contained over 91,000 observations, with the individual file’s number of observations dependent on the number of missing observations.  

```{r HOURLY DATA HEADER}
#example of the first ten weather observations made at Ft Jackson, SC.
head(Jackson_Raw, n=10)
```
Publicly releasable version of shapefile data for military installations was obtained from the Defense Installations Spatial Data Infrastructure portal. This file includes data on nine attributes (variables) for 859 military installations (observations) within United States territory. The data file was wrangled using the dyplr pipe function to first select for two columns, ‘FULLNAME’ and ‘geometry’, then filtering by ‘FULLNAME’ for each of the four installations of interest. This resulted in four 1x2 size data frames, one for each installation, containing installation name and multipolygon geometry.  

```{r}
#inspect the features in the Installation shape file data.
(All_Installations_sf)
```
2018 county data at 20-meter resolution was obtained from the US Census Bureau and used to build State boundary maps. This file contains data for ten attributes (variables) for 3,220 counties (observations) within the United States. A data frame for each State with a basic training installation was created by filtering this dataset using the appropriate STATEFP, resulting in a data frame for each State of 10 variables and the number of observations corresponding to the number of counties in the State. 

```{r EXAMPLE SHOWING SOUTH CAROLINA}
#filtering data and creating State maps; showing SC as the example.
GA_counties_sf<- All_Counties %>% 
  filter(STATEFP == 13) 

MO_counties_sf<- All_Counties %>% 
  filter(STATEFP == 29) 

SC_counties_sf<- All_Counties %>% 
  filter(STATEFP == 45) 

OK_counties_sf<- All_Counties %>% 
  filter(STATEFP == 40) 

head(SC_counties_sf)
mapview(SC_counties_sf)
```


\newpage

# Exploratory Analysis 
## Exploratory Analysis Question #1a: Are trends the same or different for Heat Index and Wet Bulb Globe Temperature? 

## Exploratory Analysis Question #1b: Are there trends in the number of “Black Flag” and “Red Flag” days at the installations? 
"Black Flag" refers to days when the local WBGT is >90 Fahrenheit. At this temperature, training on military installations is significantly curtailed. "Red Flag" days refer to temperatures between XX and XX degrees Fahrenheit. To answer a question about numbers and trends for "Black" and "Red" flag days, we first created a table with the standard for each color level and called this table "Hazardous_Days_Limits".
```{r}
#Load the temperature thresholds
HD_First_Column <- c("None","Green","Yellow","Red","Black")
HD_Temp_Min <- c(32,82,85,88,90)
HD_Temp_Min <- as.numeric(HD_Temp_Min)
HD_Temp_Min <- signif(HD_Temp_Min,digits=2)
HD_Temp_Max <- c(81.999,84.999,87.999,89.999,104)
HD_Temp_Max <- as.numeric(HD_Temp_Max)
HD_Temp_Max <- signif(HD_Temp_Max,digits=2)
Hazardous_Days_Limits <- cbind(HD_First_Column,HD_Temp_Min,HD_Temp_Max)
Hazardous_Days_Limits <- as.data.frame(Hazardous_Days_Limits)
Hazardous_Days_Limits$HD_Temp_Min <- as.integer(Hazardous_Days_Limits$HD_Temp_Min)
Hazardous_Days_Limits$HD_Temp_Max <- as.integer(Hazardous_Days_Limits$HD_Temp_Max)

Hazardous_Days_Limits <-  Hazardous_Days_Limits%>%
  mutate(HD_Temp_Min_C = (HD_Temp_Min-32)*(5/9))%>%
  mutate(HD_Temp_Max_C = (HD_Temp_Max-32)*(5/9))%>%
  rename(Flag_Color=HD_First_Column, Temp_Limit_Max_F=HD_Temp_Max,Temp_Limit_Min_F=HD_Temp_Min, Temp_Limit_Min_C=HD_Temp_Min_C, Temp_Limit_Max_C=HD_Temp_Max_C)
Hazardous_Days_Limits
```


## Exploratory Analysis Question #2: How many days was the temperature in each of the “Color Flag” temperature categories for each installation?

\newpage

# Analysis



## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 

---
title: "Time Series"
author: "Austin Guimond"
date: "2022-11-22"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r Jackson Data}
getwd()
#load packages
library(tidyverse)
library(lubridate)
library(zoo)
library(ggplot2)
library(trend)
library(Kendall)
library(tseries)
library(dplyr)

#Load Jackson Data
Jackson_Raw <- read.csv("~/R/Patton_Guimond_ENV872_Final_Project/Jackson_TenYear.csv",
                         stringsAsFactors = TRUE)
Jackson_Wrangle <- Jackson_Raw %>%
  select(YEAR, MO, DAY, TEMPC) %>%
  mutate('date' = make_date(year = YEAR, month = MO, day = DAY))

#Set as date
Jackson_Wrangle$date <- as.Date(Jackson_Wrangle$date, format = "%y/%m/%d")

#Group by date and find max daily temperature
Daily_High <- Jackson_Wrangle %>%
  group_by(date) %>% 
  dplyr::summarize(value = max (TEMPC)) %>% 
  as.data.frame()
#Plot max temperatures over time
MaxTemp_Plot <- ggplot(Daily_High, aes(x = date, y = value)) +
  geom_line()+
  geom_smooth(method=lm, col= 'red')+
 ggtitle("Max Temperatures Over Time")+
  xlab("Time (Days)") + ylab("Temperature (C)")
print(MaxTemp_Plot)

#Look for NA values in data and remove
summary(Daily_High$value)
Clean_MaxTemp <- 
  Daily_High %>% 
  mutate(Temp_Clean = zoo::na.approx(value))
summary(Clean_MaxTemp)

#Filter for date and NA omitted Temp
Max_Temp <- Clean_MaxTemp%>%
  select(date, Temp_Clean)

#Create Time series object and decompose

Daily_High_ts <- ts(Max_Temp$Temp_Clean, start = c(2012,01,01), frequency = 365)
Daily_High_decomp <- stl(Daily_High_ts,s.window = "periodic")
plot(Daily_High_decomp)

Daily_Temp_Trend <- Kendall::SeasonalMannKendall(Daily_High_ts)
summary(Daily_Temp_Trend)

#Subtract seasonality and run seasonally adjusted Mann Kendall
Daily_Components <- as.data.frame(Daily_High_decomp$time.series[,1:3])

Daily_Components <- mutate(Daily_Components,
        Temp_C = Max_Temp$Temp_Clean,     
        Date = Max_Temp$date)

TempSeasonAdj <- Daily_Components %>%
  mutate(Subtract.Season = Daily_Components$Temp_C - Daily_Components$seasonal)
summary(TempSeasonAdj)

NonSeasonal_Temp_Trend <- Kendall::MannKendall(TempSeasonAdj$Subtract.Season)
summary(NonSeasonal_Temp_Trend)


```


```{r KFSI Data}
#Load Jackson Data
KFSI_Raw <- read.csv("~/R/Patton_Guimond_ENV872_Final_Project/KFSI_Observations.csv",
                         stringsAsFactors = TRUE)
Jackson_Wrangle <- Jackson_Raw %>%
  select(YEAR, MO, DAY, TEMPC) %>%
  mutate('date' = make_date(year = YEAR, month = MO, day = DAY))

#Set as date
Jackson_Wrangle$date <- as.Date(Jackson_Wrangle$date, format = "%y/%m/%d")

#Group by date and find max daily temperature
Daily_High <- Jackson_Wrangle %>%
  group_by(date) %>% 
  dplyr::summarize(value = max (TEMPC)) %>% 
  as.data.frame()
#Plot max temperatures over time
MaxTemp_Plot <- ggplot(Daily_High, aes(x = date, y = value)) +
  geom_line()+
  geom_smooth(method=lm, col= 'red')+
 ggtitle("Max Temperatures Over Time")+
  xlab("Time (Days)") + ylab("Temperature (C)")
print(MaxTemp_Plot)

#Look for NA values in data and remove
summary(Daily_High$value)
Clean_MaxTemp <- 
  Daily_High %>% 
  mutate(Temp_Clean = zoo::na.approx(value))
summary(Clean_MaxTemp)

#Filter for date and NA omitted Temp
Max_Temp <- Clean_MaxTemp%>%
  select(date, Temp_Clean)

#Create Time series object and decompose

Daily_High_ts <- ts(Max_Temp$Temp_Clean, start = c(2012,01,01), frequency = 365)
Daily_High_decomp <- stl(Daily_High_ts,s.window = "periodic")
plot(Daily_High_decomp)

Daily_Temp_Trend <- Kendall::SeasonalMannKendall(Daily_High_ts)
summary(Daily_Temp_Trend)

#Subtract seasonality and run seasonally adjusted Mann Kendall
Daily_Components <- as.data.frame(Daily_High_decomp$time.series[,1:3])

Daily_Components <- mutate(Daily_Components,
        Temp_C = Max_Temp$Temp_Clean,     
        Date = Max_Temp$date)

TempSeasonAdj <- Daily_Components %>%
  mutate(Subtract.Season = Daily_Components$Temp_C - Daily_Components$seasonal)
summary(TempSeasonAdj)

NonSeasonal_Temp_Trend <- Kendall::MannKendall(TempSeasonAdj$Subtract.Season)
summary(NonSeasonal_Temp_Trend)

```